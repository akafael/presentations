<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>reveal.js</title>

	<link rel="stylesheet" href="dist/reset.css">
	<link rel="stylesheet" href="dist/reveal.css">
	<link rel="stylesheet" href="dist/theme/black.css">

	<!-- Theme used for syntax highlighted code -->
	<link rel="stylesheet" href="plugin/highlight/monokai.css">
</head>

<body>
	<div class="reveal">
		<div class="slides">
			<section>Measuring test coverage in C</section>
			<section data-markdown>
				## Rafael
				> * Software Quality Engineer
				> * Major in Mechatronics Eng.
			</section>

			<section>
				<section data-markdown>
					## Why bother about writing automatic tests?
				</section>
				<section data-markdown>
					## None of theses ensure it will realy works:
					> *"It works on my machine..."*

					> Code build / execution without errors.

					> Code made using the language X.
				</section>

				<section data-markdown>
					## Why bother about writing automatic tests?

					* Tests are a way to translate requirements and expectations into automatic verification.
				</section>
			</section>

			<section data-markdown>
				## How much effort spend on testing?

				Sometimes even more than the development:
				![](https://www.parasoft.com/wp-content/uploads/2024/09/structural-coverage-metrics-at-the-software-unit-level.png)
			</section>

			<section data-markdown>
				## Measuring coverage in C
				* tools: gcc + gcov + lcov

				![](https://raw.githubusercontent.com/akafael/gcov-example/refs/heads/master/img/gcov-flow.jpg)
			</section>

			<section>
				<h3>Measuring test coverage</h3>
				Basic process:
				<div class="mermaid">
					<pre>
					%%{init: {'theme': 'white', 'themeVariables': { 'darkMode': true }}}%%
					graph LR
					  src --> gcc(gcc)
					  gcc -->|build| gcno[*.gcno]
					  gcc -->|build| app(app / test)
					  app -->|execution| gcda[*.gcno]

					 subgraph gcc_build
						gcc
						app
						subgraph instrumentation_output
							gcno
							gcda
						end
					 end

					 subgraph cov[gcov]
					 	gcno --> gcov
					 	gcda --> gcov

						gcov -->|lcov| reports
					 end
				  </pre>
				</div>
			</section>

			<section>
				<section data-markdown>
					## 1. Build
					Add instrumentation flags to build
					```bash
					gcc -fPIC -fprofile-arcs -ftest-coverage -o main main.c foo.o ...
					gcc -o test_main foo.o ...
					```
				</section>
				<section data-markdown>
					## 2. Run program / tests
					Run test to probe lines executed
					```bash
					./test_main
					```
				</section>
				<section data-markdown>
					## 3. Run gcov
					Execute gcov to generate the coverage report
					```bash
					gcov main.c foo.c test.c
					```
				</section>
				<section data-markdown>
					## 4. Run lcov
					Execute lcov to generate the html page from gcov report
					```bash
					mkdir lcov-report
					lcov --capture --directory . --output-file lcov-report/coverage.info
					genhtml lcov-report/coverage.info --output-directory lcov-report
					```
				</section>

				<section data-markdown>
					## Results
					![](https://raw.githubusercontent.com/akafael/gcov-example/refs/heads/master/img/foo.c.png)
				</section>
			</section>

			<section data-markdown>
				# Play time!

				> source: https://github.com/akafael/c-project-template

				1. Building a simple test from scratch ([test_utils.basic.c](https://github.com/akafael/c-project-template/blob/master/src/test_utils_basic.c))
				2. Generating lcov report
				3. Fixing code coverage ([c-project-template: PR #2](https://github.com/akafael/c-project-template/pull/2))
			</section>

			<section data-markdown>
				## Further reading
				1. [shenxianpeng: gcov example on github](https://github.com/shenxianpeng/gcov-example)
				2. [code coverage with llvm-cov](https://medium.com/@sag50692/code-coverage-with-llvm-cov-16639b71f6a5)
				3. [clang: Measuring MD/DC coverage using LLVM](https://clang.llvm.org/docs/SourceBasedCodeCoverage.html)
			</section>

			<section data-markdown>
				# Thank you!
			</section>

		</div>
	</div>

	<script src="dist/reveal.js"></script>
	<script src="plugin/notes/notes.js"></script>
	<script src="plugin/markdown/markdown.js"></script>
	<script src="plugin/highlight/highlight.js"></script>
	<script>
		// More info about initialization & config:
		// - https://revealjs.com/initialization/
		// - https://revealjs.com/config/
		Reveal.initialize({
			hash: true,

			// Learn about plugins: https://revealjs.com/plugins/
			plugins: [RevealMarkdown, RevealHighlight, RevealNotes]
		});
	</script>
	<script src="https://cdn.jsdelivr.net/npm/reveal.js@5.0.5/dist/reveal.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/reveal.js-mermaid-plugin@11.4.1/plugin/mermaid/mermaid.js"></script>
	<script>
		Reveal.initialize({
			controls: true,
			progress: true,
			center: true,
			hash: true,

			// mermaid initialize config
			mermaid: {
				// flowchart: {
				//   curve: 'linear',
				// },
			},

			// this plugin config
			// mermaidPlugin: {
			//   beforeRender(el) {
			//     console.log(el);
			//     // if return false this element will not call mermaid render
			//   },
			//
			//   afterRender(el) {
			//     console.log(el);
			//   },
			// },

			plugins: [RevealMermaid],
		});
	</script>
</body>

</html>